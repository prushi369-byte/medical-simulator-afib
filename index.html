<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rapid Response Simulator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f6f8;
            margin: 0;
            padding: 20px;
        }
        h1 {
            text-align: center;
            margin-bottom: 20px;
        }
        #game {
            max-width: 700px;
            margin: 0 auto;
            background: #ffffff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        #header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        #score, #timer {
            font-weight: bold;
    font-size: 16px;
        }
        #vitals {
            background-color: #eef5ff;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 15px;
            font-size: 15px;
            line-height: 1.4;
        }
        #message {
            margin-bottom: 15px;
            min-height: 100px;
        }
        .choice {
            display: block;
            padding: 10px 15px;
            margin: 8px 0;
            background-color: #007bff;
            color: #ffffff;
            border: none;
            border-radius: 4px;
            text-align: left;
            cursor: pointer;
            transition: background-color 0.2s;
            width: 100%;
        }
        .choice:hover {
            background-color: #0056b3;
        }
        #result {
            display: none;
            margin-top: 20px;
            padding: 15px;
border-left: 4px solid #28a745;
            background-color: #e9f7ef;
        }
        #restart {
            display: inline-block;
            padding: 10px 15px;
            margin-top: 10px;
            background-color: #28a745;
            color: #ffffff;
            border-radius: 4px;
            text-decoration: none;
            cursor: pointer;
        }
        #restart:hover {
            background-color: #218838;
        }
    </style>
</head>
<body>
    <h1>Rapid Response Simulator</h1>
    <div id="game">
        <div id="header">
            <span id="score">Score: 0</span>
            <span id="timer">Time: 300s</span>
        </div>
        <div id="vitals">
            <strong>Vitals:</strong> HR <span id="hr">160</span> bpm | BP <span id="bp">90/50</span> mmHg | SpO2 <span id="spo2">92</span>%<br>
            <strong>Status:</strong> <span id="status">Agitated</sp
an>
        </div>
        <div id="message"></div>
        <div id="actions"></div>
        <div id="result"></div>
    </div>
    <script>
    // Game state and vitals
    const initialState = {
        hr: 160,
        bpSys: 90,
        bpDia: 50,
        spo2: 92,
        status: 'Agitated',
        sedationGiven: false,
        phenylephrineDoses: 0,
        amiodaroneGiven: false,
        fluidsGiven: false,
        cardioverted: false
    };
    let state;
    let score = 0;
    let timeLeft = 300;
    let timerInterval;
    let vitalsInterval;

    // Initialize the game
    function startGame() {
        state = Object.assign({}, initialState);
        score = 0;
        timeLeft = 300;
        document.getElementById('score').textContent = 'Score: ' + score;
        document.getElementById('timer').textContent = 'Time: ' + timeLeft + 's';
        document.getElementById('resul
t').style.display = 'none';
        updateVitalsDisplay();
        showInitial();
        clearInterval(timerInterval);
        clearInterval(vitalsInterval);
        timerInterval = setInterval(updateTimer, 1000);
        vitalsInterval = setInterval(simulateDeterioration, 10000);
    }

    // Update timer each second
    function updateTimer() {
        timeLeft--;
        document.getElementById('timer').textContent = 'Time: ' + timeLeft + 's';
        if (timeLeft <= 0) {
            endGame(false, 'Time expired. The patient did not survive.', 'Delay in definitive management led to decompensation.');
        }
    }

    // Display current vitals
    function updateVitalsDisplay() {
        document.getElementById('hr').textContent = state.hr;
        document.getElementById('bp').textContent = state.bpSys + '/' + state.bpDia;
        document.getElementById('spo2').textContent = st
ate.spo2;
        document.getElementById('status').textContent = state.status;
    }

    // Gradual deterioration of vitals when unstable
    function simulateDeterioration() {
        if (state.cardioverted) return;
        // heart rate increases
        if (state.hr < 200) state.hr += Math.floor(Math.random() * 3) + 1;
        // blood pressure drops
        if (state.bpSys > 70) state.bpSys -= Math.floor(Math.random() * 3) + 1;
        if (state.bpDia > 40) state.bpDia -= Math.floor(Math.random() * 2) + 1;
        // oxygen saturation declines
        if (state.spo2 > 85) state.spo2 -= 1;
        // check for collapse
        if (state.bpSys < 80 || state.spo2 < 85) {
            endGame(false, 'The patient has deteriorated into shock and cardiac arrest.', 'Failure to provide timely resuscitation led to cardiovascular collapse.');
            return;
        }
        updateVitalsD
isplay();
    }

    // Show initial narrative and actions
    function showInitial() {
        const message = document.getElementById('message');
        message.innerHTML = 'A 67‑year‑old man with end‑stage liver failure and acute kidney injury presents with atrial fibrillation with rapid ventricular response (HR 160 bpm) and hypotension (BP 90/50 mmHg). He is tachycardic and symptomatic. Manage the patient, order diagnostic tests, and administer treatments to stabilize him. The ultimate goal is successful synchronized cardioversion.';
        const actions = document.getElementById('actions');
        actions.innerHTML = '';
        addActionButton('Order laboratory tests', showLabsMenu);
        addActionButton('Administer phenylephrine push (50–200 mcg)', givePhenylephrine);
        addActionButton('Administer etomidate sedation (0.1–0.2 mg/kg)', giveSedation);
        addActionBut
ton('Administer amiodarone 150 mg IV', giveAmiodarone);
        addActionButton('Administer 500 mL IV fluids', giveFluids);
        addActionButton('Perform synchronized cardioversion (200 J)', performCardioversion);
    }

    // Helper to add buttons
    function addActionButton(text, handler) {
        const btn = document.createElement('button');
        btn.className = 'choice';
        btn.textContent = text;
        btn.onclick = handler;
        document.getElementById('actions').appendChild(btn);
    }

    // Laboratories menu
    function showLabsMenu() {
        const message = document.getElementById('message');
        message.innerHTML = 'Select a laboratory test to order:';
        const actions = document.getElementById('actions');
        actions.innerHTML = '';
        addActionButton('Complete metabolic panel (CMP)', function() { showLabResult('CMP'); });
        addA
ctionButton('Complete blood count (CBC)', function() { showLabResult('CBC'); });
        addActionButton('Coagulation studies (INR/PT/aPTT)', function() { showLabResult('Coag'); });
        addActionButton('Serum magnesium', function() { showLabResult('Mg'); });
        addActionButton('Serum troponin', function() { showLabResult('Troponin'); });
        addActionButton('Arterial blood gas (ABG)', function() { showLabResult('ABG'); });
        addActionButton('Return to management', showInitial);
    }

    // Display results of a specific test
    function showLabResult(test) {
        const actions = document.getElementById('actions');
        actions.innerHTML = '';
        let result = '';
        switch (test) {
            case 'CMP':
                result = 'CMP results:<br>Na 130 mEq/L (low); K 4.9 mEq/L; Cl 95 mEq/L; HCO₃⁻ 18 mEq/L; BUN 45 mg/dL; Creatinine 3.2 mg/dL (acute kidney injury); AST 80 U/L; ALT 70 U/L; total bilirubin 4.2 mg/dL; albumin 2.5 g/dL (liver failure).';
                break;
            case 'CBC':
                result = 'CBC results:<br>WBC 8.5 × 10³/µL; Hemoglobin 11 g/dL; Hematocrit 33%; Platelets 110 × 10³/µL (thrombocytopenia).';
                break;
            case 'Coag':
                result = 'Coagulation studies:<br>INR 2.3; PT 20 seconds; aPTT 45 seconds (prolonged).';
                break;
            case 'Mg':
                result = 'Serum magnesium level: 1.2 mg/dL (low).';
                break;
            case 'Troponin':
                result = 'Serum troponin: 0.02 ng/mL (normal), suggesting no acute myocardial infarction.';
                break;
            case 'ABG':
                result = 'Arterial blood gas: pH 7.30; pCO₂ 35 mmHg; pO₂ 60 mmHg; HCO₃⁻ 18 mEq/L; lactate 3.5 mmol/L (elevated), indicating metabolic acidosis and hypoxia.';
                break;
        }
        const message = document.getElementById('message');
        message.innerHTML = result;
        addActionButton('Order another lab', showLabsMenu);
        addActionButton('Return to management', showInitial);
    }

    // Administer phenylephrine push
    function givePhenylephrine() {
        if (state.cardioverted) return;
        state.phenylephrineDoses++;
        // Increase blood pressure
        state.bpSys += 20;
        state.bpDia += 10;
        // Reflex bradycardia
        state.hr -= 5;
        if (state.hr < 80) state.hr = 80;
        updateVitalsDisplay();
        score += 1;
        document.getElementById('score').textContent = 'Score: ' + score;
        const message = document.getElementById('message');
        message.innerHTML = 'You administer phenylephrine 100 mcg (within 50–200 mcg range). Blood pressure improves temporarily, but the arrhythmia persists. Phenylephrine is a pure α₁‑agonist administered in doses of 50–200 mcg every 2–5 minutes, with onset of action around 1 minute and duration of about 15 minutes【625478307504753†L255-L260】.';
    }

    // Administer etomidate sedation
    function giveSedation() {
        if (state.cardioverted) return;
        if (state.sedationGiven) {
            document.getElementById('message').innerHTML = 'Sedation has already been administered.';
            return;
        }
        state.sedationGiven = true;
        score += 1;
        document.getElementById('score').textContent = 'Score: ' + score;
        const message = document.getElementById('message');
        message.innerHTML = 'You administer etomidate 0.1 mg/kg for procedural sedation. Etomidate provides deep sedation with minimal effect on blood pressure or heart rate【859073297557175†L109-L130】. The patient is sedated and ready for cardioversion.';
    }

    // Administer amiodarone
    function giveAmiodarone() {
        if (state.cardioverted) return;
        if (state.amiodaroneGiven) {
            document.getElementById('message').innerHTML = 'Amiodarone is already running.';
            return;
        }
        state.amiodaroneGiven = true;
        // Reduce heart rate slightly and drop blood pressure
        state.hr -= 10;
        state.bpSys -= 5;
        state.bpDia -= 3;
        updateVitalsDisplay();
        const message = document.getElementById('message');
        message.innerHTML = 'You administer amiodarone 150 mg IV over 10 minutes followed by an infusion at 1 mg/min【714019201285831†L90-L103】. This may slow the ventricular rate but has limited immediate effect on unstable atrial fibrillation and may worsen hypotension. Expert consultation is recommended for use of amiodarone in tachyarrhythmias.';
    }

    // Administer fluids
    function giveFluids() {
        if (state.cardioverted) return;
        if (state.fluidsGiven) {
            document.getElementById('message').innerHTML = 'An initial fluid bolus has already been given.';
            return;
        }
        state.fluidsGiven = true;
        state.bpSys += 10;
        state.bpDia += 5;
        // Slight decrease in oxygen saturation due to fluid overload risk
        state.spo2 -= 1;
        updateVitalsDisplay();
        const message = document.getElementById('message');
        message.innerHTML = 'You administer 500 mL of isotonic crystalloid. Blood pressure improves modestly, but the underlying arrhythmia persists. In patients with cirrhosis and acute kidney injury, fluid responsiveness may be limited.';
    }

    // Perform synchronized 
cardioversion
    function performCardioversion() {
        if (state.cardioverted) {
            document.getElementById('message').innerHTML = 'Cardioversion already completed successfully.';
            return;
        }
        // ensure not too hypotensive
        if (state.bpSys < 80) {
            endGame(false, 'Attempted cardioversion failed due to profound hypotension.', 'Cardioversion cannot be performed effectively in profound shock. Support blood pressure before attempting electrical therapy.');
            return;
        }
        state.cardioverted = true;
        state.hr = 80;
        state.bpSys = 110;
        state.bpDia = 70;
        state.spo2 = 98;
        state.status = 'Stable';
        updateVitalsDisplay();
        score += 2;
        document.getElementById('score').textContent = 'Score: ' + score;
        const message = document.getElementById('message');
  
      message.innerHTML = 'You perform synchronized cardioversion at 200 J biphasic. The rhythm converts to sinus. The patient’s blood pressure improves and he becomes stable. Continue supportive care and address reversible causes. Immediate synchronized cardioversion is the recommended treatment for hemodynamically unstable atrial fibrillation【613177164401872†L27-L33】.';
        // After a short delay, show final result
        setTimeout(function() {
            endGame(true, '', '');
        }, 8000);
    }

    // Finish game with success or failure
    function endGame(success, messageText, explanation) {
        clearInterval(timerInterval);
        clearInterval(vitalsInterval);
        // Hide action buttons
        document.getElementById('actions').innerHTML = '';
        const result = document.getElementById('result');
        let html = '';
        if (messageText) {
       
     html += '<p>' + messageText + '</p>';
        }
        if (success) {
            html += '<p><strong>Outcome:</strong> The patient survived and is now stable.</p>';
        } else {
            html += '<p><strong>Outcome:</strong> The patient did not survive.</p>';
        }
        if (explanation) {
            html += '<p><strong>Explanation:</strong> ' + explanation + '</p>';
        }
        html += '<p><strong>Final Score:</strong> ' + score + '</p>';
        html += '<p><strong>Time remaining:</strong> ' + timeLeft + 's</p>';
        html += '<a id="restart" href="#">Play again</a>';
        result.innerHTML = html;
        result.style.display = 'block';
        document.getElementById('restart').onclick = function(e) {
            e.preventDefault();
            result.style.display = 'none';
            startGame();
        };
    }

    // Start the game when the page
 loads
    window.onload = startGame;
    </script>
</body>
</ht<ml>
